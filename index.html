<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Current Weather</title>
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,900" rel="stylesheet">
        <link href="style.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div id="weather">
        <label>Post Code (First Half Only)</label>
        <input id="post-code" type="text" pattern="[0-9]{5}" title="First half post code" />
        <label for="direction">Which Direction Are You Travelling?:</label>
            <select name="direction" id="direction">
            <option value="N">N</option>
            <option value="NE">NE</option>
            <option value="E">E</option>
            <option value="SE">SE</option>
            <option value="S">S</option>
            <option value="SW">SW</option>
            <option value="W">W</option>
            <option value="NW">NW</option>
        </select>
        <button id="submit">Submit</button>
        <div id="description"></div> 
        <h1 id="temp"></h1>
        <div id="location"></div>
        <h1 id="wind-speed"></h1>
        <h1 id="wind-direction"></h1>
        
    </div>
    <script lang="text/javascript">
        
        const travel = document.getElementById('direction');
        const postCode = document.getElementById('post-code');
        const submit = document.getElementById('submit');
        let travelDirection;
        
        const cityID = 2654710;
        let postCodeValue;

        travelDirection = travel.value;
        postCodeValue = postCode.value;

        function weatherBalloon( postCode ) {
            var key = '36b033476dd5cea0c38cb227411b005f';
            fetch('https://api.openweathermap.org/data/2.5/weather?zip=' + postCode + ',gb&appid=' + key)  
            .then(function(resp) { return resp.json() }) // Convert data to json
            .then(function(data) {
                drawWeather(data);
            })
            .catch(function() {
                // catch any errors
            });
        }
        
        
        function drawWeather( d ) {
            var celcius = Math.round(parseFloat(d.main.temp)-273.15);
            var fahrenheit = Math.round(((parseFloat(d.main.temp)-273.15)*1.8)+32); 
            var description = d.weather[0].description;
            let windDirectionDeg = d.wind.deg;
            let windDirection;
            let windSpeed = Math.round(d.wind.speed * 2.23694);
        
            // Later, add arrow and rotate it based on whihc direction wind is going. Use if statement in function below
            function convertWindDirection (w) {
                if (w >= 348.75 && w <= 365) {
                    windDirection = 'N';
                } else if (w >= 0 && w < 11.25) {
                    windDirection = 'N';
                } else if (w >= 11.25 && w < 33.75) {
                    windDirection = 'NNE';
                } else if (w >= 33.75 && w < 56.25) {
                    windDirection = 'NE';
                } else if (w >= 56.25 && w < 78.75) {
                    windDirection = 'ENE';
                } else if (w >= 78.75 && w < 101.25) {
                    windDirection = 'E'; 
                } else if (w >= 101.25 && w < 123.75) {
                    windDirection = 'ESE';
                } else if (w >= 123.75 && w < 146.25) {
                    windDirection = 'SE';
                } else if (w >= 146.25 && w < 168.75) {
                    windDirection = 'SSE';
                } else if (w >= 168.75 && w < 191.25) {
                    windDirection = 'S';
                } else if (w >= 191.25 && w < 213.75) {
                    windDirection = 'SSW';
                } else if (w >= 213.75 && w < 236.25) {
                    windDirection = 'SW';
                } else if (w >= 236.25 && w < 258.75) {
                    windDirection = 'WSW';
                } else if (w >= 258.75 && w < 281.25) {
                    windDirection = 'W';
                } else if (w >= 281.25 && w < 303.75) {
                    windDirection = 'WNW';
                } else if (w >= 303.75 && w < 326.25) {
                    windDirection = 'NW';
                } else if (w >= 326.25 && w < 348.75) {
                    windDirection = 'NNW';
                } 
            }
            convertWindDirection(windDirectionDeg);
            console.log(windDirection);
            
            document.getElementById('description').innerHTML = description;
            document.getElementById('temp').innerHTML = celcius + '&deg;';
            document.getElementById('location').innerHTML = d.name;
            document.getElementById('wind-speed').innerHTML = windSpeed;
            document.getElementById('wind-direction').innerHTML = windDirection;
            
            
            

            console.log(d.weather.main);
        
            
            if( description.indexOf('rain') > 0 ) {
                    document.body.className = 'rainy';
            } else if( description.indexOf('cloud') > 0 ) {
                document.body.className = 'cloudy';
            } else if( description.indexOf('sunny') > 0 ) {
                    document.body.className = 'sunny';
            }

            submit.addEventListener('click', function bikeOrBus () {
            //  travelDirection = travel.value;
            //  postCodeValue = postCode.value;
            // alert(travelDirection);
            // Add wind speed in once other tests defintiely work
            // ADD FOR WNW/SWS/NWN/NEN/ESE ETC

            if (travelDirection === 'N' && windDirection === 'S') {
                console.log('Bus');
            } else if (travelDirection === 'NE' && windDirection === 'SW') {
                console.log('Bus');
            } else if (travelDirection === 'E' && windDirection === 'W') {
                console.log('Bus');
            } else if (travelDirection === 'SE' && windDirection === 'NW') {
                console.log('Bus');
            } else if (travelDirection === 'S' && windDirection === 'N') {
                console.log('Bus');
            } else if (travelDirection === 'SW' && windDirection === 'NE') {
                console.log('Bus');
            } else if (travelDirection === 'W' && windDirection === 'E') {
                console.log('Bus');
            } else if (travelDirection === 'NW' && windDirection === 'SE') {
                console.log('Bus');
            } else {
                console.log('Bike');
            }
            });
        }

        window.onload = function() {
            weatherBalloon( postCode );
        }
    </script>

        <!-- HTML for inputs -->
        <!-- <button id="showDescription">Show Description</button>
        <div id="description">
            <p>I cycle to work every morning along Brighton's seafront. It gets windy... very windy. Each morning I check my weather app to see if 1. The wind is pointing towards me (from the west) and 2. if the wind speed is above 25mph. If both of those conditions are true, then I get the bus. Other wise, I cycle. This app aims to calculate this for me each morning.</p>
        </div>
        <br>
        <input type="text" id="mph">
        <button id="calculate">Calculate</button>
        <div id="answer"></div>
        
        <script>
        const showDescription = document.getElementById('showDescription');
        const description = document.getElementById('description');
        const mph = document.getElementById('mph');
        const calculate = document.getElementById('calculate');
        const answer = document.getElementById('answer');

        
        showDescription.addEventListener('click', function showDesc () {
            
            if (description.style.display === "none") {
                description.style.display = 'block';
                showDescription.innerHTML = "Hide Description";
            } else  {
                description.style.display = 'none';
                showDescription.innerHTML = "Show Description";
            }
        });

        

        calculate.addEventListener('click', function calc () {
            // check if mph.value is >= 25
            if (mph.value <= 25 && mph.value > 0) {
                answer.innerHTML = "<h1>Cycle</h1>";
            } else if (mph.value > 25) {
                answer.innerHTML = "<h1>Don't Cycle</h1>";
            } else  {
                alert('please submit a value');
            }
        });
        
        
        </script> -->
    </body>
</html>